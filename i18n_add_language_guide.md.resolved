# HÆ°á»›ng Dáº«n ThÃªm NgÃ´n Ngá»¯ Má»›i

## ğŸ“‹ Tá»•ng Quan

Há»‡ thá»‘ng i18n Ä‘Ã£ Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ dá»… dÃ ng má»Ÿ rá»™ng. Báº¡n cÃ³ thá»ƒ thÃªm bao nhiÃªu ngÃ´n ngá»¯ tÃ¹y thÃ­ch mÃ  khÃ´ng cáº§n thay Ä‘á»•i cáº¥u trÃºc database.

---

## ğŸš€ CÃ¡ch ThÃªm NgÃ´n Ngá»¯ Má»›i

### VÃ­ dá»¥: ThÃªm Tiáº¿ng Nháº­t (ja), Tiáº¿ng HÃ n (ko), Tiáº¿ng Trung (zh)

---

## 1ï¸âƒ£ Backend Configuration

### BÆ°á»›c 1: Update Domain Constants

**File:** [internal/core/domain/translation.go](file:///t:/OWNER_DAT/CODE/OWNER/CMS_BLOG/go-cms-be/internal/core/domain/translation.go)

```go
// ThÃªm locale constants má»›i
const (
    LocaleEnglish    = "en"
    LocaleVietnamese = "vi"
    LocaleFrench     = "fr"
    LocaleJapanese   = "ja"  // â† ThÃªm má»›i
    LocaleKorean     = "ko"  // â† ThÃªm má»›i
    LocaleChinese    = "zh"  // â† ThÃªm má»›i
    LocaleDefault    = LocaleEnglish
)

// Update supported locales
var SupportedLocales = []string{
    LocaleEnglish, 
    LocaleVietnamese, 
    LocaleFrench,
    LocaleJapanese,  // â† ThÃªm má»›i
    LocaleKorean,    // â† ThÃªm má»›i
    LocaleChinese,   // â† ThÃªm má»›i
}
```

**Xong!** Backend tá»± Ä‘á»™ng há»— trá»£ ngÃ´n ngá»¯ má»›i vÃ¬:
- âœ… Database dÃ¹ng JSONB (flexible)
- âœ… Validation check [SupportedLocales](file:///t:/OWNER_DAT/CODE/OWNER/CMS_BLOG/go-cms-be/internal/http/handlers/translation_handler.go#108-120)
- âœ… API endpoints khÃ´ng cáº§n thay Ä‘á»•i

---

## 2ï¸âƒ£ Frontend Configuration

### BÆ°á»›c 1: Update i18n Config

**File:** [src/i18n/config.ts](file:///t:/OWNER_DAT/CODE/OWNER/CMS_BLOG/next-cms-fe/src/i18n/config.ts)

```typescript
export const locales = [
  'en', 
  'vi', 
  'fr',
  'ja',  // â† ThÃªm má»›i
  'ko',  // â† ThÃªm má»›i
  'zh',  // â† ThÃªm má»›i
] as const;

export const localeNames: Record<Locale, string> = {
  en: 'English',
  vi: 'Tiáº¿ng Viá»‡t',
  fr: 'FranÃ§ais',
  ja: 'æ—¥æœ¬èª',      // â† ThÃªm má»›i
  ko: 'í•œêµ­ì–´',       // â† ThÃªm má»›i
  zh: 'ä¸­æ–‡',         // â† ThÃªm má»›i
};

export const localeFlags: Record<Locale, string> = {
  en: 'ğŸ‡¬ğŸ‡§',
  vi: 'ğŸ‡»ğŸ‡³',
  fr: 'ğŸ‡«ğŸ‡·',
  ja: 'ğŸ‡¯ğŸ‡µ',  // â† ThÃªm má»›i
  ko: 'ğŸ‡°ğŸ‡·',  // â† ThÃªm má»›i
  zh: 'ğŸ‡¨ğŸ‡³',  // â† ThÃªm má»›i
};
```

### BÆ°á»›c 2: Táº¡o Translation Files

**File:** `src/i18n/locales/ja.json`

```json
{
  "common": {
    "welcome": "ã‚ˆã†ã“ã",
    "home": "ãƒ›ãƒ¼ãƒ ",
    "about": "ã«ã¤ã„ã¦",
    "contact": "ãŠå•ã„åˆã‚ã›",
    "login": "ãƒ­ã‚°ã‚¤ãƒ³",
    "logout": "ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ",
    ...
  },
  "navigation": {
    "dashboard": "ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰",
    "posts": "æŠ•ç¨¿",
    ...
  }
}
```

**File:** `src/i18n/locales/ko.json`

```json
{
  "common": {
    "welcome": "í™˜ì˜í•©ë‹ˆë‹¤",
    "home": "í™ˆ",
    "about": "ì†Œê°œ",
    "contact": "ì—°ë½ì²˜",
    "login": "ë¡œê·¸ì¸",
    "logout": "ë¡œê·¸ì•„ì›ƒ",
    ...
  }
}
```

**File:** `src/i18n/locales/zh.json`

```json
{
  "common": {
    "welcome": "æ¬¢è¿",
    "home": "é¦–é¡µ",
    "about": "å…³äº",
    "contact": "è”ç³»",
    "login": "ç™»å½•",
    "logout": "ç™»å‡º",
    ...
  }
}
```

**Xong!** Language switcher tá»± Ä‘á»™ng hiá»ƒn thá»‹ ngÃ´n ngá»¯ má»›i.

---

## 3ï¸âƒ£ ThÃªm Translation Cho Content CÃ³ Sáºµn

### CÃ¡ch 1: Qua API (Recommended)

```bash
# ThÃªm translation cho post cÃ³ sáºµn
PUT /api/v1/posts/123
{
  "title_translations": {
    "en": "Hello World",
    "vi": "Xin chÃ o tháº¿ giá»›i",
    "fr": "Bonjour le monde",
    "ja": "ã“ã‚“ã«ã¡ã¯ä¸–ç•Œ",  // â† ThÃªm má»›i
    "ko": "ì•ˆë…•í•˜ì„¸ìš” ì„¸ê³„",  // â† ThÃªm má»›i
    "zh": "ä½ å¥½ä¸–ç•Œ"          // â† ThÃªm má»›i
  },
  "content_translations": {
    "en": "This is content...",
    "vi": "ÄÃ¢y lÃ  ná»™i dung...",
    "ja": "ã“ã‚Œã¯ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã§ã™...",
    "ko": "ì´ê²ƒì€ ì½˜í…ì¸ ì…ë‹ˆë‹¤...",
    "zh": "è¿™æ˜¯å†…å®¹..."
  }
}
```

### CÃ¡ch 2: Qua SQL (Bulk Update)

```sql
-- ThÃªm translation cho táº¥t cáº£ posts
UPDATE posts 
SET title_translations = title_translations || '{"ja": "æ—¥æœ¬èªã‚¿ã‚¤ãƒˆãƒ«"}'::jsonb
WHERE id = 1;

-- Hoáº·c bulk update
UPDATE posts 
SET title_translations = jsonb_set(
    COALESCE(title_translations, '{}'::jsonb),
    '{ja}',
    '"æ—¥æœ¬èªã‚¿ã‚¤ãƒˆãƒ«"'
)
WHERE title_translations IS NOT NULL;
```

### CÃ¡ch 3: Qua Admin UI (Tá»‘t nháº¥t)

Táº¡o Translation Editor Component:

```typescript
// src/components/translation-editor.tsx
'use client';

import { useState } from 'react';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Input } from '@/components/ui/input';
import { Textarea } from '@/components/ui/textarea';
import { locales, localeNames, localeFlags } from '@/i18n/config';

interface TranslationEditorProps {
  field: 'title' | 'content' | 'excerpt';
  translations: Record<string, string>;
  onChange: (translations: Record<string, string>) => void;
}

export function TranslationEditor({ 
  field, 
  translations, 
  onChange 
}: TranslationEditorProps) {
  const [values, setValues] = useState(translations || {});

  const handleChange = (locale: string, value: string) => {
    const newValues = { ...values, [locale]: value };
    setValues(newValues);
    onChange(newValues);
  };

  return (
    <Tabs defaultValue="en">
      <TabsList>
        {locales.map((locale) => (
          <TabsTrigger key={locale} value={locale}>
            {localeFlags[locale]} {localeNames[locale]}
          </TabsTrigger>
        ))}
      </TabsList>

      {locales.map((locale) => (
        <TabsContent key={locale} value={locale}>
          {field === 'content' ? (
            <Textarea
              value={values[locale] || ''}
              onChange={(e) => handleChange(locale, e.target.value)}
              placeholder={`Enter ${field} in ${localeNames[locale]}`}
              rows={10}
            />
          ) : (
            <Input
              value={values[locale] || ''}
              onChange={(e) => handleChange(locale, e.target.value)}
              placeholder={`Enter ${field} in ${localeNames[locale]}`}
            />
          )}
        </TabsContent>
      ))}
    </Tabs>
  );
}
```

**Sá»­ dá»¥ng trong Post Form:**

```typescript
// In post-form.tsx
import { TranslationEditor } from '@/components/translation-editor';

export function PostForm() {
  const [titleTranslations, setTitleTranslations] = useState({});
  const [contentTranslations, setContentTranslations] = useState({});

  return (
    <Form>
      {/* Title Translations */}
      <FormField name="title_translations">
        <FormLabel>Title (All Languages)</FormLabel>
        <TranslationEditor
          field="title"
          translations={titleTranslations}
          onChange={setTitleTranslations}
        />
      </FormField>

      {/* Content Translations */}
      <FormField name="content_translations">
        <FormLabel>Content (All Languages)</FormLabel>
        <TranslationEditor
          field="content"
          translations={contentTranslations}
          onChange={setContentTranslations}
        />
      </FormField>
    </Form>
  );
}
```

---

## 4ï¸âƒ£ Migration Strategy

### Chiáº¿n lÆ°á»£c 1: Dá»‹ch Dáº§n (Recommended)

```typescript
// Hiá»ƒn thá»‹ content vá»›i fallback
function getContent(post: Post, locale: string) {
  // 1. Thá»­ láº¥y translation cho locale hiá»‡n táº¡i
  if (post.title_translations?.[locale]) {
    return post.title_translations[locale];
  }
  
  // 2. Fallback sang English
  if (post.title_translations?.['en']) {
    return post.title_translations['en'];
  }
  
  // 3. Fallback sang title gá»‘c
  return post.title;
}
```

**Æ¯u Ä‘iá»ƒm:**
- âœ… KhÃ´ng cáº§n dá»‹ch háº¿t ngay
- âœ… Há»‡ thá»‘ng váº«n hoáº¡t Ä‘á»™ng bÃ¬nh thÆ°á»ng
- âœ… Dá»‹ch tá»« tá»« theo nhu cáº§u

### Chiáº¿n lÆ°á»£c 2: Auto-translate (Optional)

```typescript
// Sá»­ dá»¥ng Google Translate API
async function autoTranslate(text: string, targetLocale: string) {
  const response = await fetch(
    `https://translation.googleapis.com/language/translate/v2`,
    {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        q: text,
        target: targetLocale,
        key: process.env.GOOGLE_TRANSLATE_API_KEY,
      }),
    }
  );
  
  const data = await response.json();
  return data.data.translations[0].translatedText;
}

// Bulk auto-translate
async function bulkTranslatePosts(targetLocale: string) {
  const posts = await postService.getPosts();
  
  for (const post of posts) {
    const translatedTitle = await autoTranslate(post.title, targetLocale);
    const translatedContent = await autoTranslate(post.content, targetLocale);
    
    await postService.updatePost(post.id, {
      title_translations: {
        ...post.title_translations,
        [targetLocale]: translatedTitle,
      },
      content_translations: {
        ...post.content_translations,
        [targetLocale]: translatedContent,
      },
    });
  }
}
```

---

## 5ï¸âƒ£ Checklist ThÃªm NgÃ´n Ngá»¯ Má»›i

### Backend
- [ ] Update [SupportedLocales](file:///t:/OWNER_DAT/CODE/OWNER/CMS_BLOG/go-cms-be/internal/http/handlers/translation_handler.go#108-120) trong [translation.go](file:///t:/OWNER_DAT/CODE/OWNER/CMS_BLOG/go-cms-be/internal/core/domain/translation.go)
- [ ] KhÃ´ng cáº§n migration database (JSONB tá»± Ä‘á»™ng support)
- [ ] Test API endpoints

### Frontend
- [ ] Update `locales` array trong [config.ts](file:///t:/OWNER_DAT/CODE/OWNER/CMS_BLOG/next-cms-fe/next.config.ts)
- [ ] ThÃªm `localeNames` vÃ  `localeFlags`
- [ ] Táº¡o file translation má»›i (e.g., `ja.json`)
- [ ] Copy structure tá»« [en.json](file:///t:/OWNER_DAT/CODE/OWNER/CMS_BLOG/next-cms-fe/src/i18n/locales/en.json)
- [ ] Dá»‹ch táº¥t cáº£ keys

### Content
- [ ] Quyáº¿t Ä‘á»‹nh chiáº¿n lÆ°á»£c migration (dáº§n hoáº·c bulk)
- [ ] Táº¡o Translation Editor UI (optional)
- [ ] ThÃªm translations cho content quan trá»ng
- [ ] Test hiá»ƒn thá»‹ vá»›i locale má»›i

---

## 6ï¸âƒ£ Best Practices

### âœ… DO

1. **DÃ¹ng JSONB cho flexibility**
   ```json
   {
     "en": "Hello",
     "vi": "Xin chÃ o",
     "ja": "ã“ã‚“ã«ã¡ã¯",
     "future_lang": "..."
   }
   ```

2. **LuÃ´n cÃ³ fallback**
   ```typescript
   const title = translations[locale] || translations['en'] || defaultTitle;
   ```

3. **Validate locale trÆ°á»›c khi save**
   ```go
   if !domain.IsValidLocale(locale) {
       return errors.New("invalid locale")
   }
   ```

4. **TÃ¡ch UI translations vÃ  Content translations**
   - UI: DÃ¹ng translation files (en.json, vi.json)
   - Content: DÃ¹ng JSONB columns

### âŒ DON'T

1. **Äá»«ng táº¡o column riÃªng cho má»—i ngÃ´n ngá»¯**
   ```sql
   -- âŒ BAD
   ALTER TABLE posts ADD COLUMN title_en TEXT;
   ALTER TABLE posts ADD COLUMN title_vi TEXT;
   ALTER TABLE posts ADD COLUMN title_fr TEXT;
   
   -- âœ… GOOD
   ALTER TABLE posts ADD COLUMN title_translations JSONB;
   ```

2. **Äá»«ng hardcode locales**
   ```typescript
   // âŒ BAD
   if (locale === 'en' || locale === 'vi' || locale === 'fr') {}
   
   // âœ… GOOD
   if (locales.includes(locale)) {}
   ```

3. **Äá»«ng bá» qua fallback**
   ```typescript
   // âŒ BAD
   const title = translations[locale]; // CÃ³ thá»ƒ undefined
   
   // âœ… GOOD
   const title = translations[locale] || translations['en'] || '';
   ```

---

## 7ï¸âƒ£ Example: ThÃªm Tiáº¿ng TÃ¢y Ban Nha (es)

### 1. Backend (1 dÃ²ng)
```go
var SupportedLocales = []string{"en", "vi", "fr", "es"}
```

### 2. Frontend Config (3 dÃ²ng)
```typescript
export const locales = ['en', 'vi', 'fr', 'es'];
export const localeNames = { ..., es: 'EspaÃ±ol' };
export const localeFlags = { ..., es: 'ğŸ‡ªğŸ‡¸' };
```

### 3. Translation File
```bash
cp src/i18n/locales/en.json src/i18n/locales/es.json
# Edit es.json vÃ  dá»‹ch
```

### 4. Test
```bash
# Restart app
npm run dev

# Language switcher sáº½ tá»± Ä‘á»™ng hiá»ƒn thá»‹ EspaÃ±ol ğŸ‡ªğŸ‡¸
```

**Xong!** Chá»‰ cáº§n 5 phÃºt! ğŸš€

---

## ğŸ“Š Summary

| Task | Time | Difficulty |
|------|------|------------|
| Add locale to backend | 1 min | â­ Easy |
| Add locale to frontend | 2 min | â­ Easy |
| Create translation file | 30-60 min | â­â­ Medium |
| Translate existing content | Varies | â­â­â­ Hard |

**Total:** ~1-2 hours cho 1 ngÃ´n ngá»¯ má»›i (bao gá»“m dá»‹ch UI)

---

## ğŸ¯ Káº¿t Luáº­n

Há»‡ thá»‘ng i18n Ä‘Ã£ Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ:
- âœ… Dá»… dÃ ng thÃªm ngÃ´n ngá»¯ má»›i
- âœ… KhÃ´ng cáº§n migration database
- âœ… Tá»± Ä‘á»™ng fallback
- âœ… Flexible vá»›i JSONB
- âœ… Scalable (há»— trá»£ unlimited languages)

**Báº¡n cÃ³ thá»ƒ thÃªm bao nhiÃªu ngÃ´n ngá»¯ tÃ¹y thÃ­ch mÃ  khÃ´ng lo vá» performance hay database structure!** ğŸŒ
